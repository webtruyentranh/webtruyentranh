{% extends "base.html" %}
{% block content %}

<style>
/* ===========================
   THEME & RESET
   =========================== */
:root{
  --bg:#0b0f14;
  --surface:#0f141b;
  --surface-2:#0d1218;
  --card:#111721;
  --line:#1e2632;
  --text:#e7edf3;
  --muted:#9fb2c7;
  --primary:#35a5f5;
  --primary-2:#1687d8;
  --success:#4ade80;
  --danger:#ef4444;
  --shadow:0 18px 40px rgba(0,0,0,.35);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
img{max-width:100%;display:block}
button{font:inherit}
a{color:inherit;text-decoration:none}

/* ===========================
   LAYOUT CHUNG
   =========================== */
.container, .profile-wrap{padding:38px 16px}
.container--narrow, .profile-card{
  max-width:980px;margin:0 auto;
}

/* ===========================
   CARD H·ªí S∆†
   =========================== */
.profile-card{
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)), var(--card);
  border:1px solid var(--line);
  border-radius:20px;
  padding:28px 26px 26px;
  box-shadow:var(--shadow), inset 0 1px 0 rgba(255,255,255,.03);
}
.profile-title{
  margin:6px 0 24px;
  text-align:center;
  font-size:28px;
  font-weight:800;
  letter-spacing:.2px;
}

/* ===========================
   AVATAR + N√öT CH·ªåN ·∫¢NH
   =========================== */
.avatar-block{display:flex;align-items:center;gap:14px;margin-bottom:10px}
.avatar{
  width:84px;height:84px;border-radius:999px;object-fit:cover;
  border:2px solid #223041;box-shadow:0 4px 10px rgba(0,0,0,.25);
}
.btn, .btn-light, .btn-primary{
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:10px 14px;border-radius:12px;border:none;cursor:pointer;
  font-weight:800;letter-spacing:.2px;transition:transform .18s ease, box-shadow .18s ease, background .22s ease;
}
.btn-light{background:var(--primary);color:#fff;box-shadow:0 8px 20px rgba(40,167,255,.25)}
.btn-light:hover{background:var(--primary-2);transform:translateY(-1px)}

/* ===========================
   L∆Ø·ªöI TH√îNG TIN
   =========================== */
.info-grid{
  display:grid;grid-template-columns:1fr 1fr;gap:18px
}
.form-item{display:flex;flex-direction:column;gap:8px}
.form-item label{color:var(--muted);font-size:13px}
input[type="text"], textarea, .pf-pwd input{
  width:100%;
  background:var(--surface-2);
  color:var(--text);
  border:1px solid var(--line);
  border-radius:12px;
  padding:12px 14px;
  outline:none;
  transition:border-color .2s, box-shadow .2s, background .2s;
}
textarea{resize:vertical;min-height:120px;grid-column:1 / -1}
input:focus, textarea:focus, .pf-pwd input:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(40,167,255,.15);
  background:var(--surface);
}

/* ===========================
   H√ÄNG M·∫¨T KH·∫®U (tr√°i 1 √¥, ph·∫£i 2 √¥)
   =========================== */
.pwd-row{
  display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:6px
}
/* √î m·ªõi + nh·∫≠p l·∫°i n·∫±m c·ªôt ph·∫£i */
.pwd-row .new{grid-column:2}
.pf-pwd{position:relative}
.pf-pwd input{padding-right:44px}
.pf-pwd .eye{
  position:absolute;right:10px;top:50%;transform:translateY(-50%);
  width:30px;height:30px;border:none;border-radius:8px;
  background:transparent;color:var(--muted);cursor:pointer;font-size:18px;
  display:inline-flex;align-items:center;justify-content:center;
  transition:color .15s, background .15s
}
.pf-pwd .eye:hover{color:var(--success);background:rgba(255,255,255,.04)}

/* ===========================
   H√ÄNH ƒê·ªòNG
   =========================== */
.actions{margin-top:22px;display:flex;justify-content:center}
.btn-primary{
  background:var(--primary);color:#fff;box-shadow:0 12px 24px rgba(40,167,255,.25)
}
.btn-primary:hover{background:var(--primary-2);transform:translateY(-1px)}

/* ===========================
   TOAST TH√îNG B√ÅO (t√πy ch·ªçn)
   =========================== */
.toast{
  position:fixed;right:18px;bottom:18px;z-index:9999;
  background:var(--surface);border:1px solid var(--line);
  padding:10px 14px;border-radius:12px;box-shadow:var(--shadow);color:var(--text);
  display:none
}
.toast.show{display:block;animation:fade 2s ease}
@keyframes fade{0%{opacity:0}10%{opacity:1}90%{opacity:1}100%{opacity:0}}

/* ===========================
   FORM STATE (error / success)
   =========================== */
.input-error{border-color:var(--danger)!important;box-shadow:0 0 0 3px rgba(239,68,68,.2)!important}
.input-ok{border-color:var(--success)!important;box-shadow:0 0 0 3px rgba(74,222,128,.18)!important}

/* ===========================
   RESPONSIVE
   =========================== */
@media (max-width: 900px){
  .info-grid{grid-template-columns:1fr}
  .pwd-row{grid-template-columns:1fr}
  .pwd-row .new{grid-column:1}
}

</style>
<div class="profile-wrap">
  <div class="profile-card">
    <h1 class="profile-title">Ch·ªânh s·ª≠a th√¥ng tin c√° nh√¢n</h1>

    <form action="{{ url_for('api_save_profile') }}" method="post" enctype="multipart/form-data" class="profile-form">
      <div class="avatar-block">
        <img class="avatar" src="{{ user.avatar_url or url_for('static', filename='img/default-avatar.png') }}" alt="avatar">
        <label class="btn-light">
          <input type="file" name="avatar" accept="image/*" hidden>
          Ch·ªçn ·∫£nh
        </label>
      </div>

      <div class="info-grid">
        <div class="form-item">
          <label>T√™n hi·ªÉn th·ªã</label>
          <input type="text" name="display_name" value="{{ user.username or '' }}">
        </div>
        <div class="form-item">
          <label>S·ªë ƒëi·ªán tho·∫°i</label>
          <input type="text" name="phone" value="{{ user.phone or '' }}">
        </div>
        <div class="form-item form-span">
          <label>Gi·ªõi thi·ªáu</label>
          <textarea name="bio" rows="3">{{ user.bio or '' }}</textarea>
        </div>

        <div class="form-item">
          <label>M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
          <div class="pf-pwd">
            <input type="password" name="current_password" id="curPwd">
            <button type="button" class="eye" data-for="curPwd">üëÅ</button>
          </div>
        </div>
        <div class="pwd-right">
    <div class="form-item">
      <label>M·∫≠t kh·∫©u m·ªõi</label>
      <div class="pf-pwd">
        <input type="password" name="new_password" id="newPwd">
        <button type="button" class="eye" data-for="newPwd" aria-label="Hi·ªán/·∫©n m·∫≠t kh·∫©u">üëÅ</button>
      </div>
    </div>

    <div class="form-item">
      <label>Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi</label>
      <div class="pf-pwd">
        <input type="password" name="confirm_password" id="cfPwd">
        <button type="button" class="eye" data-for="cfPwd" aria-label="Hi·ªán/·∫©n m·∫≠t kh·∫©u">üëÅ</button>
      </div>
    </div>
      </div>

      <div class="actions">
        <button class="btn-primary" type="submit">üíæ L∆∞u thay ƒë·ªïi</button>
      </div>
    </form>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('click', function(e){
  const btn = e.target.closest('.eye');
  if (!btn) return;
  e.preventDefault();
  const inp = document.getElementById(btn.dataset.for);
  if (!inp) return;
  inp.type = (inp.type === 'password') ? 'text' : 'password';
  btn.textContent = (inp.type === 'password') ? 'üëÅ' : 'üôà';
});
</script>
{% endblock %}


